
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Dashboard Scripts</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style> body{background:#3c3c3c} .container-card{max-width:1100px;margin:20px auto;padding:20px;background:#02020295;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)} </style>
</head>
<body>
<div class="container container-card">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 style="color:rgba(228, 255, 122, 0.952);">Dashboard Scripts</h4>
        <div>
            <a href="{{ url_for('run_script') }}" class="btn btn-success">‚ûï New Script</a>
            <a href="{{ url_for('logout') }}" class="btn btn-danger">Logout</a>
        </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, msg in messages %}
          <div class="alert alert-{{ 'danger' if category=='danger' else ('success' if category=='success' else 'info') }}">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <table class="table table-bordered">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Script Name</th>
                <th>Timestamp</th>
                <th>Run Type</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for script in scripts %}
            <tr>
                <td>{{ script[0] }}</td>
                <td>{{ script[1] }}</td>
                <td>{{ script[2] }}</td>
                <td>{{ script[3] }}</td>
                <td>{{ script[4] }}</td>
                <td>
                    <a href="{{ url_for('start_script', script_id=script[0]) }}" class="btn btn-success btn-sm">‚ñ∂</a>
                    <a href="{{ url_for('pause_script', script_id=script[0]) }}" class="btn btn-warning btn-sm">‚è∏</a>
                    <a href="{{ url_for('edit_script', script_id=script[0]) }}" class="btn btn-primary btn-sm">üìù</a>
                    <a href="{{ url_for('delete_script', script_id=script[0]) }}" class="btn btn-danger btn-sm">üóë</a>
                    <button class="btn btn-info btn-sm" onclick="loadLogs({{ script[0] }}, 'output')" data-bs-toggle="modal" data-bs-target="#logModal">üìú Output</button>
                    <button class="btn btn-dark btn-sm" onclick="loadLogs({{ script[0] }}, 'error')" data-bs-toggle="modal" data-bs-target="#logModal">‚ö†Ô∏è Error</button>
                    <button class="btn btn-secondary btn-sm" onclick="loadLogs({{ script[0] }}, 'success_log')" data-bs-toggle="modal" data-bs-target="#logModal">‚úÖ Success</button>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<!-- Logs Modal -->
<div class="modal fade" id="logModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Logs</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <ul id="logsList" class="list-group"></ul>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
function loadLogs(scriptId, type) {
    fetch(`/logs/${scriptId}?type=${type}`)
      .then(res => res.json())
      .then(data => {
          let logsList = document.getElementById("logsList");
          logsList.innerHTML = "";
          if(data.length === 0) {
              logsList.innerHTML = '<li class="list-group-item">No logs found</li>';
              return;
          }
          data.forEach(log => {
              let li = document.createElement("li");
              li.className = "list-group-item";
              let ts = log[1] ? log[1] : '';
              li.innerText = ts + " ‚Üí " + (log[0] ? log[0] : '(empty)');
              logsList.appendChild(li);
          });
      });
}
</script>
</body>
</html>
